<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜ˆì¸¡ì¹˜ ì œì¶œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 16px;
      line-height: 1.5;
    }
    h1 { font-size: 1.4rem; margin-bottom: 12px; }
    label { display: block; margin-top: 12px; font-weight: 600; }
    input, select, button {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      box-sizing: border-box;
      font-size: 1rem;
    }
    button {
      margin-top: 16px;
      cursor: pointer;
    }
    #status {
      margin-top: 12px;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <h1>ì˜ˆì¸¡ì¹˜ ì œì¶œ</h1>
  <p style="font-size:0.9rem;color:#555;">
    ì²˜ìŒ í•œ ë²ˆì€ <b>ì´ë¦„/ê·¸ë£¹ë²ˆí˜¸/íšŒì°¨/ê°’</b>ì„ ì…ë ¥í•˜ê³ ,<br>
    ì´í›„ì—ëŠ” ë¸Œë¼ìš°ì €ê°€ <b>ì´ë¦„/ê·¸ë£¹ë²ˆí˜¸</b>ë¥¼ ê¸°ì–µí•´ì„œ íšŒì°¨ì™€ ê°’ë§Œ ë°”ê¾¸ë©´ ë©ë‹ˆë‹¤.
  </p>

  <form id="prediction-form">
    <label for="name">ì´ë¦„</label>
    <input id="name" type="text" required />

    <label for="group">ê·¸ë£¹ ë²ˆí˜¸ (ì˜ˆ: 1, 2, 3...)</label>
    <input id="group" type="text" required />

    <label for="round">íšŒì°¨</label>
    <select id="round" required>
      <option value="1">1íšŒì°¨</option>
      <option value="2">2íšŒì°¨</option>
      <option value="3">3íšŒì°¨</option>
      <option value="4">4íšŒì°¨</option>
      <option value="5">5íšŒì°¨</option>
      <option value="6">6íšŒì°¨</option>
    </select>

    <label for="value">ì˜ˆì¸¡ì¹˜ (ìˆ«ì)</label>
    <input id="value" type="number" step="0.01" required />

    <button type="submit">ì œì¶œí•˜ê¸°</button>
  </form>

  <p id="status"></p>

  <!-- Firebase SDK (compat ë²„ì „) -->
  <script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore-compat.js"></script>

  <script>
    // ğŸ”¹ 1) Firebase ì„¤ì • (ì½˜ì†”ì—ì„œ ë³µì‚¬í•œ ë‚´ìš©ìœ¼ë¡œ êµì²´!)
    const firebaseConfig = {
      apiKey: "AIzaSyD85EPLcL_j7s-WOQ1FDimMKEYmzBFzapE",
  authDomain: "bean-counting.firebaseapp.com",
  projectId: "bean-counting",
  storageBucket: "bean-counting.firebasestorage.app",
  messagingSenderId: "700257917650",
  appId: "1:700257917650:web:c7821b3e1b1b5f1a366b0b"
    };

    // ğŸ”¹ 2) Firebase & Firestore ì´ˆê¸°í™”
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const form = document.getElementById('prediction-form');
    const nameInput = document.getElementById('name');
    const groupInput = document.getElementById('group');
    const roundSelect = document.getElementById('round');
    const valueInput = document.getElementById('value');
    const statusEl = document.getElementById('status');

    // ğŸ”¹ 3) localStorageì—ì„œ ì €ì¥ëœ ì´ë¦„/ê·¸ë£¹ ë¶ˆëŸ¬ì˜¤ê¸°
    const savedName = localStorage.getItem('studentName');
    const savedGroup = localStorage.getItem('studentGroup');

    if (savedName) nameInput.value = savedName;
    if (savedGroup) groupInput.value = savedGroup;

    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      statusEl.textContent = 'ì œì¶œ ì¤‘ì…ë‹ˆë‹¤...';

      const name = nameInput.value.trim();
      const group = groupInput.value.trim();
      const round = parseInt(roundSelect.value, 10);
      const value = parseFloat(valueInput.value);

      if (!name || !group || isNaN(round) || isNaN(value)) {
        statusEl.textContent = 'ì…ë ¥ê°’ì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.';
        return;
      }

      try {
        await db.collection('predictions').add({
          name,
          group,
          round,
          value,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        // ë¸Œë¼ìš°ì €ì— ì´ë¦„/ê·¸ë£¹ ì €ì¥ â†’ ë‹¤ìŒë¶€í„° ìë™ ì…ë ¥
        localStorage.setItem('studentName', name);
        localStorage.setItem('studentGroup', group);

        statusEl.textContent = `${round}íšŒì°¨ ì˜ˆì¸¡ì¹˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!`;
        valueInput.value = ''; // ê°’ë§Œ ë¹„ìš°ê¸°
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
      }
    });
  </script>
</body>
</html>
